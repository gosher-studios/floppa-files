{% extends "base.html" %} {% block content %}
<div class="bg-fg p-4 rounded-md text-accent" id="list" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
  <span class="text-white hidden sm:inline"># Upload files with curl:<br></span>
  <span class="hidden sm:inline">$ curl -T (file) {{url}}<br><br></span>
  <span class="text-white hidden sm:inline"># Or drag here to upload:<br></span>
  <label for="file" class="text-accent text-4xl sm:text-lg cursor-pointer underline">Select File</label>
  <div id="list" class="text-base"></div>
</div>
<input id="file" type="file" class="hidden" multiple onchange="uploadHandler(event);"/>
<script>
  async function dropHandler(e) {
    e.preventDefault();
    let arr = Array.from([...e.dataTransfer.items]);
    upload(arr.filter((item) => item.kind == "file").map((item) => item.getAsFile()));
    };

  function dragOverHandler(e) {
    e.preventDefault()
  }

  function uploadHandler(e) {
    upload(Array.from([...e.target.files]));
  }

  async function upload(files) {
    console.log("upload");
    for (let i = 0; i < files.length; i++) {
      let file = files[i];

      let log = document.createElement("p");
      log.innerText = `Uploading ${file.name}`;
      document.getElementById("list").appendChild(log);

      let res = await fetch(file.name, {
        method: 'PUT',
        body: file,
        headers: {
          'Content-Type': 'text/plain'
        }
      }).catch(error => {
        log.innerText = `Failed to Upload ${file.name}`;
      });
      if (res.status == 200) {
        let url = await res.text();
        log.innerHTML = `<a class="underline" href="${url}">${url}</a>`;
      } else {
        log.innerHTML = `<img src="https://http.cat/${res.status}" />`;
      }
    }
  }
</script>
{% endblock %}